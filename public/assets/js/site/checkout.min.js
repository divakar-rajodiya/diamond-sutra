var format = new Intl.NumberFormat('hi-IN', {
    style: 'currency',
    currency: 'INR',
    minimumFractionDigits: 0,
});

$(document).on("click", "#same-as-billing-check", function () {
    if (!$("#same-as-billing-check").is(":checked")) {
        $("#shipping-address-btn").removeClass("collapsed");
        $("#shipping-address-btn").attr("area-expended", true);
        $("#collapseOne").addClass("show");
    } else {
        $("#shipping-address-btn").addClass("collapsed");
        $("#shipping-address-btn").attr("area-expended", false);
        $("#collapseOne").removeClass("show");
    }
});
 
$("#make-checkout").on("click", () => {
    $('#checkout').show();
    $("#make-checkout").prop("disabled", true);
    $("#checkout-form")
        .ajaxForm(function (res) {
            $('#checkout').hide();
            // Toast(res.msg, 3000, res.flag);
            if (res.flag === 1) {
                // $("#checkout-form")[0].reset();
                // setTimeout(function () {
                //     // window.location.href = $('#base_url').val() + "/order-detail/" + res.data.order_id
                //     window.location.href = $('#base_url').val() + "/thank-you/" + res.data.order_id;
                // }, 1000);

                var value = new FormData();
                var token = $("#token").val();
                value.append('_token', token);
                value.append('amount', $('#product-final-amount').val());
                value.append('phone_no',$('#b-phone_number').val());
                value.append('user_name', $('#b-fname').val()+' '+$('#b-lname').val());
                value.append('email', $('#b-email').val());
                $.ajax({
                    url: $('#base_url').val() + "/create-order",
                    type: 'post',
                    data: value,
                    contentType: false,
                    processData: false,
                    success: function(res) {
                        console.log(res)
                        if(res.flag == 1)
                        {
                            const cashfree = Cashfree({
                                mode: "sandbox" //or production, // sandbox
                            });
                            cashfree.checkout({
                                paymentSessionId: res.payment_session_id,
                            });
                        }
                    }
                })
            }else
            {
                Toast(res.msg, 3000, res.flag);
            }
            $("#make-checkout").prop("disabled", false);
        })
        .submit();
});
 
$("#applu-coupon-btn").on("click", () => {
    $("#applu-coupon-btn").prop("disabled", true);

    let url = $('#base_url').val() + '/coupon/apply'
    postAjax(url, { coupon: $('#coupanfield').val() }, function (res) {
        console.log(res);
        Toast(res.msg, 3000, res.flag);
        $("#applu-coupon-btn").prop("disabled", false);
        $('#coupanfield').val('')
        let couponDiv = `<tr>
                            <th class="p-2"><strong> Coupon Discount (`+res.data.coupon_code+`)</strong></th>
                            <td class="p-2 text-end"><b>${format.format(res.data.discount)}/-</b></td>
                        </tr>`

        $('.selected_coupon_amount').text('â‚¹' + res.data.discount + '/-');
        $('.selected_coupon_code').text(res.data.coupon_code);
        $('#shippind-detail-div').after(couponDiv);
        let final_amount = $('#cart-total').data('amount');
        console.log('fiinal : ', final_amount);
        final_amount = parseInt(final_amount) - parseInt(res.data.discount);
        window.location.reload();
    });
});
